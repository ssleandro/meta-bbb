From 883dd3606a96a7b2a180c411381dc3adf6087253 Mon Sep 17 00:00:00 2001
From: Otavio Salvador <otavio@ossystems.com.br>
Date: Tue, 20 Jul 2021 15:12:35 -0300
Subject: [PATCH] agent: Allow setting the log level to use
Organization: O.S. Systems Software LTDA.

Signed-off-by: Otavio Salvador <otavio@ossystems.com.br>
---
 agent/main.go | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/agent/main.go b/agent/main.go
index 16787ff..c39fa75 100644
--- a/agent/main.go
+++ b/agent/main.go
@@ -50,6 +50,9 @@ type ConfigOptions struct {
 	// multi-user mode (with root privileges) is enabled by default.
 	// NOTE: The password hash could be generated by ```openssl passwd```.
 	SingleUserPassword string `envconfig:"simple_user_password"`
+
+	// Log level to use. Valid values are 'info', 'warning', 'error', 'debug', and 'trace'.
+	LogLevel string `envconfig:"log_level" default:"info"`
 }
 
 func main() {
@@ -64,6 +67,14 @@ func main() {
 		logrus.Fatal(err)
 	}
 
+	// Set the log level accordingly to the configuration.
+	level, err := logrus.ParseLevel(opts.LogLevel)
+	if err != nil {
+		logrus.Error("Invalid log level has been provided.")
+		os.Exit(1)
+	}
+	logrus.SetLevel(level)
+
 	if os.Geteuid() == 0 && opts.SingleUserPassword != "" {
 		logrus.Error("ShellHub agent cannot run as root when single-user mode is enabled.")
 		logrus.Error("To disable single-user mode unset SHELLHUB_SINGLE_USER_PASSWORD env.")
-- 
2.32.0

